{"ast":null,"code":"'use strict';\n\nvar _require = require('readable-stream'),\n    Writable = _require.Writable;\n\nvar util = require('util');\n\nvar defaults = require('defaults');\n/**\n * Writable stream that accepts results in either object or string mode and outputs the text to a supplied html element\n *\n * Can show interim results when in objectMode\n *\n * @param {Object} options\n * @param {String|DOMElement} options.outputElement\n * @param {String} [options.property] what property of the element should the text be set to. Defaults to `value` for `<input>`s and `<textarea>`s, `textContent` for everything else\n * @param {Boolean} [options.clear=true] delete any previous text\n * @constructor\n */\n\n\nfunction WritableElementStream(options) {\n  this.options = options = defaults(options, {\n    decodeStrings: false,\n    // false = don't convert strings to buffers before passing to _write (only applies in string mode)\n    property: null,\n    clear: true\n  });\n  this.el = typeof options.outputElement === 'string' ? document.querySelector(options.outputElement) : options.outputElement;\n\n  if (!this.el) {\n    throw new Error('Watson Speech to Text WritableElementStream: missing outputElement');\n  }\n\n  Writable.call(this, options); // for most elements we set the textContent, but for form elements, the value property is probably the expected target\n\n  var propMap = {\n    INPUT: 'value',\n    TEXTAREA: 'value'\n  };\n  this.prop = options.property || propMap[this.el.nodeName] || 'textContent';\n\n  if (options.clear) {\n    this.el[this.prop] = '';\n  }\n\n  if (options.objectMode) {\n    this.finalizedText = this.el[this.prop];\n    this._write = this.writeObject;\n  } else {\n    this._write = this.writeString;\n  }\n}\n\nutil.inherits(WritableElementStream, Writable);\n\nWritableElementStream.prototype.writeString = function writeString(text, encoding, next) {\n  this.el[this.prop] += text;\n  next();\n};\n\nWritableElementStream.prototype.writeObject = function writeObject(data, encoding, next) {\n  if (Array.isArray(data.results)) {\n    data.results.forEach(function (result) {\n      if (result.final) {\n        this.finalizedText += result.alternatives[0].transcript;\n        this.el[this.prop] = this.finalizedText;\n      } else {\n        this.el[this.prop] = this.finalizedText + result.alternatives[0].transcript;\n      }\n    }, this);\n  }\n\n  next();\n};\n\nmodule.exports = WritableElementStream;","map":null,"metadata":{},"sourceType":"script"}